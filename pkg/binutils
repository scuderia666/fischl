dynamic no

[src]
http://ftp.gnu.org/gnu/binutils/binutils-2.27.tar.bz2

[build]
sed -i '/^SUBDIRS/s/doc//' bfd/Makefile.in

%stuff/libibertyfix libiberty
[ %stage = 0 ] && CC=%root/bin/musl-gcc
machine=
xconfflags=
if [ %stage = 0 ]; then
        machine=$($CC -dumpmachine)
        xconfflags="--host=$machine --target=$machine"
        export GCC_FOR_TARGET="$CC"
fi
static_ldflags=-Wl,-static
static_ccflags=-static
config_lto_flags=
if [ %dynamic = yes ]; then
	static_ldflags=
	static_ccflags=
	config_lto_flags=--enable-lto
fi
LDFLAGS="$static_ldflags" \
CC="$CC $static_ccflags" \
CFLAGS="-D_GNU_SOURCE -D_LARGEFILE64_SOURCE" \
./configure -C --prefix=%prefix $xconfflags \
  --disable-nls --disable-werror \
  --enable-initfini-array \
  --disable-separate-code \
  --enable-deterministic-archives \
  --disable-install-libbfd $config_arch_flags $config_lto_flags

%make
make DESTDIR=%dest install-gas install-ld install-binutils

mkdir -p %dest/lib/bfd-plugins
ln -sf /lib/bfd-plugins/liblto_plugin.so %dest/lib/bfd-plugins/liblto_plugin.so
rm -f %dest/bin/ld
ln -sf ld.bfd %dest/bin/ld
